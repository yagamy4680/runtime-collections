#!/bin/bash
#
source $(dirname $0)/funcs
initiateVariables

# Check whether /root/.yrc_profile exists
#
[ -f "${RC_PROFILE}" ] && echo "already hooked" && exit 0

NODE_RUNTIME=$1
[ "" == "${NODE_RUNTIME}" ] && NODE_RUNTIME=$($(dirname $0)/nodejs_list_runtimes latest)
[ "" == "${MODULE_PROFILE}" ] && MODULE_PROFILE="default"

VERSION=$(cat ${RC_NODE_RUNTIME_DIR}/${NODE_RUNTIME}/${RC_NODE_CONFIG_FILE} | grep "^nodejs" |  grep version | awk -F'\t' '{print $3}')

cat <<EOF > ${RC_PROFILE}
# Generated by scripts at $(date '+%Y/%m/%d %H:%M:%S')
#
nodejs_version	${VERSION}
nodejs_runtime	${NODE_RUNTIME}
nodejs_module_profile	${MODULE_PROFILE}
EOF

sed -i '/mount_nodejs/d' /root/.bashrc
CURRENT=$(pwd)
cd $(dirname $0)
cd ..
cat <<EOF >> "/root/.bashrc"
RC_ROOT=${RC_ROOT} eval "source ${RC_ROOT}/scripts/funcs_bashrc && mount_nodejs"
EOF

echo -e "hooked with runtime $(LIGHT_GREEN ${NODE_RUNTIME}) (nodejs: $(YELLOW ${VERSION})) with module profile $(GRAY ${MODULE_PROFILE})"
