#!/bin/bash
#
source $(dirname $0)/funcs
initiateVariables

# Check whether /root/.yrc_profile exists
#
[ -f "${RC_PROFILE}" ] && echo "already hooked" && exit 0

RUNTIME=$($(dirname $0)/nodejs_list_runtimes latest)
[ "" == "$1" ] && MODULE_PROFILE="default" || MODULE_PROFILE=$1

VERSION=$(cat ${RC_NODE_RUNTIME_DIR}/${RUNTIME}/${RC_NODE_CONFIG_FILE} | grep "^nodejs" |  grep version | awk -F'\t' '{print $3}')

cat <<EOF > ${RC_PROFILE}
# Generated by scripts at $(date '+%Y/%m/%d %H:%M:%S')
#
nodejs_version	${VERSION}
nodejs_runtime	${RUNTIME}
nodejs_module_profile	${MODULE_PROFILE}
EOF

sed -i '/\/nodejs_bashrc/d' /root/.bashrc
CURRENT=$(pwd)
cd $(dirname $0)
cd ..
cat <<EOF >> "/root/.bashrc"
RC_ROOT=$(pwd) eval "\$(cat $(pwd)/scripts/nodejs_bashrc)"
EOF

echo -e "hooked with runtime $(LIGHT_GREEN ${RUNTIME}) (nodejs: $(YELLOW ${VERSION})) with module profile $(GRAY ${MODULE_PROFILE})"
